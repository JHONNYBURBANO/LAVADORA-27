library IEEE;
use IEEE.STD_LOGIC_1164.ALL;

entity MOTOR_VACIADO is
    port( 
        CLK : in std_logic;
        VSW2, VSW1, VSW0 : in std_logic;
        VPWM1, VPWM2    : out std_logic
    );
end MOTOR_VACIADO;

architecture Behavioral of MOTOR_VACIADO is
    signal COUNT : integer range 0 to 50_000 := 0;
    signal SPEED : integer := 50_000;
begin

    -- Proceso para ajustar la velocidad del motor según SW0 y SW1
    process(VSW0, VSW1)
    begin
        if (VSW1 = '1' and VSW0 = '1') then
            SPEED <= 0;          -- Motor apagado
        elsif (VSW1 = '1' and VSW0 = '0') then
            SPEED <= 27_000;     -- Velocidad baja
        elsif (VSW1 = '0' and VSW0 = '1') then
            SPEED <= 33_000;     -- Velocidad media
        else
            SPEED <= 50_000;     -- Velocidad alta
        end if;
    end process;

    -- Proceso principal para generar la señal PWM y controlar la dirección
    process(CLK)
    begin
        if rising_edge(CLK) then
            COUNT <= COUNT + 1;
            
            if COUNT = 49_999 then
                COUNT <= 0;  -- Reinicia el contador al final del periodo PWM
            end if;
            
            if COUNT < SPEED then
                if VSW2 = '0' then
                    VPWM2 <= '0';
                    VPWM1 <= '1';  -- Dirección 1
                else
                    VPWM1 <= '0';
                    VPWM2 <= '1';  -- Dirección 2
                end if;
            else
                VPWM1 <= '0';
                VPWM2 <= '0';  -- Motor apagado en esta parte del ciclo PWM
            end if;
        end if;
    end process;

end Behavioral;
